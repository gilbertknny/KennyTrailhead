<?xml version="1.0" encoding="UTF-8"?>
<Flow xmlns="http://soap.sforce.com/2006/04/metadata">
    <apiVersion>62.0</apiVersion>
    <areMetricsLoggedToDataCloud>false</areMetricsLoggedToDataCloud>
    <assignments>
        <name>Set_Application_on_Loan</name>
        <label>Set Application on Loan</label>
        <locationX>50</locationX>
        <locationY>384</locationY>
        <assignmentItems>
            <assignToReference>Get_Loan.Application__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Create_Calculator</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Set_Calculation_Result</name>
        <label>Set Calculation Result</label>
        <locationX>534</locationX>
        <locationY>600</locationY>
        <assignmentItems>
            <assignToReference>var_CalculatorResult</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Calculation_Result</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>var_CalculatorResult.related_id__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Calculation_Result</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Set_calculator_result</name>
        <label>Set calculator result</label>
        <locationX>446</locationX>
        <locationY>1308</locationY>
        <assignmentItems>
            <assignToReference>var_CalculatorResult</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Get_Calculation_Result</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Copy_1_of_Check_Loan_Product_Type</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Set_First_Installment</name>
        <label>Set First Installment</label>
        <locationX>314</locationX>
        <locationY>1524</locationY>
        <assignmentItems>
            <assignToReference>var_CalculatorResult.installment__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Get_Amortization.Interest_Only_Output</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Copy_1_of_Update_Survey_Set_Application_ID</targetReference>
        </connector>
    </assignments>
    <decisions>
        <name>Check_Loan_Product_Type</name>
        <label>Check Loan Product Type</label>
        <locationX>446</locationX>
        <locationY>792</locationY>
        <defaultConnector>
            <targetReference>Upsert_Calculation_Result</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>PRK_Flexi_Biz</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>Copy_1_of_Get_Loan.Product_Type__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Flexi-Biz</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Get_Amortization</targetReference>
            </connector>
            <label>PRK / Flexi Biz</label>
        </rules>
    </decisions>
    <decisions>
        <name>Copy_1_of_Check_Loan_Product_Type</name>
        <label>Copy 1 of Check Loan Product Type</label>
        <locationX>446</locationX>
        <locationY>1416</locationY>
        <defaultConnector>
            <targetReference>Copy_1_of_Update_Survey_Set_Application_ID</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>Copy_1_of_PRK_Flexi_Biz</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>Copy_1_of_Get_Loan.Product_Type__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Flexi-Biz</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Set_First_Installment</targetReference>
            </connector>
            <label>Copy 1 of PRK / Flexi Biz</label>
        </rules>
    </decisions>
    <description>11 Apr 2025 - Remove Auto Create Document</description>
    <environments>Default</environments>
    <formulas>
        <name>func_EffectiveRate</name>
        <dataType>Number</dataType>
        <expression>IF(ISBLANK({!$Record.Survey__r.Effective_Rate__c}) == FALSE, {!$Record.Survey__r.Effective_Rate__c}/100, {!var_CalculatorResult.effective_rate__c})</expression>
        <scale>2</scale>
    </formulas>
    <formulas>
        <name>func_FlatRate</name>
        <dataType>Number</dataType>
        <expression>{!var_CalculatorResult.flat_rate__c} * 100</expression>
        <scale>2</scale>
    </formulas>
    <formulas>
        <name>func_LTVOfAssetMarketPrice</name>
        <dataType>Number</dataType>
        <expression>{!var_CalculatorResult.ltv_ratio__c} * 100</expression>
        <scale>2</scale>
    </formulas>
    <interviewLabel>[Tgr] Generate Default Document on New Application {!$Flow.CurrentDateTime}</interviewLabel>
    <label>[Tgr] OnNew Application</label>
    <loops>
        <name>Calculation_Result</name>
        <label>Calculation Result</label>
        <locationX>446</locationX>
        <locationY>492</locationY>
        <collectionReference>Calculate.CalculationResultList</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>Set_Calculation_Result</targetReference>
        </nextValueConnector>
        <noMoreValuesConnector>
            <targetReference>Check_Loan_Product_Type</targetReference>
        </noMoreValuesConnector>
    </loops>
    <processMetadataValues>
        <name>BuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>CanvasMode</name>
        <value>
            <stringValue>AUTO_LAYOUT_CANVAS</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>OriginBuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processType>AutoLaunchedFlow</processType>
    <recordCreates>
        <name>Create_Calculator</name>
        <label>Create Calculator</label>
        <locationX>50</locationX>
        <locationY>492</locationY>
        <connector>
            <targetReference>Update_Loan</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>related_id__c</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </filters>
        <inputAssignments>
            <field>asset_code__c</field>
            <value>
                <elementReference>Get_Loan.Asset_Code__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>asset_type__c</field>
            <value>
                <elementReference>Get_Loan.Asset_Type__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>building_value__c</field>
            <value>
                <elementReference>Get_Loan.Market_Price_Estimation__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>construction_class_code__c</field>
            <value>
                <elementReference>Get_Loan.Kelas_Kontruksi__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>owner_asset__c</field>
            <value>
                <elementReference>Get_Loan.Owner_Asset__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>related_id__c</field>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>risk_occupation_code__c</field>
            <value>
                <elementReference>Get_Loan.Risk_Occupation_Code__c</elementReference>
            </value>
        </inputAssignments>
        <object>API_Loan_Calculator_Non_KPR__c</object>
        <operationMultMatchingRecords>UpdateLatestRecord</operationMultMatchingRecords>
        <operationOneMatchingRecord>UpdateAllRecords</operationOneMatchingRecord>
        <operationZeroMatchingRecords>AddRecord</operationZeroMatchingRecords>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordCreates>
    <recordCreates>
        <name>Create_Legal_Document_Object</name>
        <label>Create Legal Document Object</label>
        <locationX>50</locationX>
        <locationY>1140</locationY>
        <connector>
            <targetReference>Update_Application</targetReference>
        </connector>
        <inputAssignments>
            <field>application_id__c</field>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </inputAssignments>
        <object>Legal_Document__c</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordCreates>
    <recordCreates>
        <name>Create_Legal_Opini_Approval</name>
        <label>Create Legal Opini Approval</label>
        <locationX>50</locationX>
        <locationY>1032</locationY>
        <connector>
            <targetReference>Create_Legal_Document_Object</targetReference>
        </connector>
        <inputAssignments>
            <field>Application__c</field>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Name</field>
            <value>
                <elementReference>Create_Legal_Opini_Object</elementReference>
            </value>
        </inputAssignments>
        <object>Legal_Opini_Approval__c</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordCreates>
    <recordCreates>
        <name>Create_Legal_Opini_Object</name>
        <label>Create Legal Opini Object</label>
        <locationX>50</locationX>
        <locationY>924</locationY>
        <connector>
            <targetReference>Create_Legal_Opini_Approval</targetReference>
        </connector>
        <inputAssignments>
            <field>Application__c</field>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </inputAssignments>
        <object>Legal_Opini__c</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordCreates>
    <recordCreates>
        <name>Upsert_Calculation_Result</name>
        <label>Upsert Calculation Result</label>
        <locationX>446</locationX>
        <locationY>1092</locationY>
        <connector>
            <targetReference>Get_Calculation_Result</targetReference>
        </connector>
        <inputReference>var_CalculatorResult</inputReference>
    </recordCreates>
    <recordLookups>
        <name>Copy_1_of_Get_Loan</name>
        <label>Get Loan</label>
        <locationX>446</locationX>
        <locationY>276</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Calculate</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>$Record.Loan_Information__c</elementReference>
            </value>
        </filters>
        <getFirstRecordOnly>true</getFirstRecordOnly>
        <object>Opportunity</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <name>Get_Calculation_Result</name>
        <label>Get Calculation Result</label>
        <locationX>446</locationX>
        <locationY>1200</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Set_calculator_result</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>related_id__c</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </filters>
        <getFirstRecordOnly>true</getFirstRecordOnly>
        <object>API_Loan_Calculator_Non_KPR__c</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <name>Get_Loan</name>
        <label>Get Loan</label>
        <locationX>50</locationX>
        <locationY>276</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Set_Application_on_Loan</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>$Record.Loan_Information__c</elementReference>
            </value>
        </filters>
        <getFirstRecordOnly>true</getFirstRecordOnly>
        <object>Opportunity</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordUpdates>
        <name>Copy_1_of_Update_Survey_Set_Application_ID</name>
        <label>Update Survey (Set Calculator Result)</label>
        <locationX>446</locationX>
        <locationY>1716</locationY>
        <connector>
            <targetReference>Update_Loan_First_Installment</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>$Record.Survey__c</elementReference>
            </value>
        </filters>
        <inputAssignments>
            <field>Application_ID__c</field>
            <value>
                <elementReference>$Record.Application_ID__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>First_Installment__c</field>
            <value>
                <elementReference>var_CalculatorResult.installment__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Flat_Rate__c</field>
            <value>
                <elementReference>func_FlatRate</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Funding_Amount__c</field>
            <value>
                <elementReference>var_CalculatorResult.ntf_amount__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Monthly_Installment__c</field>
            <value>
                <elementReference>var_CalculatorResult.installment__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Notary_Fee__c</field>
            <value>
                <elementReference>var_CalculatorResult.notary_fee__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Premi_Asuransi_Jiwa__c</field>
            <value>
                <elementReference>var_CalculatorResult.life_insurance_premium__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Premi_Asuransi_Kebakaran__c</field>
            <value>
                <elementReference>var_CalculatorResult.asset_insurance_premium__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Premi_Santunan__c</field>
            <value>
                <elementReference>var_CalculatorResult.santunan_insurance_premium__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Total_Biaya_Asuransi__c</field>
            <value>
                <elementReference>var_CalculatorResult.total_insurance_premium__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Total_TDP__c</field>
            <value>
                <elementReference>var_CalculatorResult.total_down_payment_amount__c</elementReference>
            </value>
        </inputAssignments>
        <object>Survey__c</object>
    </recordUpdates>
    <recordUpdates>
        <name>Update_Application</name>
        <label>Update Application</label>
        <locationX>50</locationX>
        <locationY>1248</locationY>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </filters>
        <inputAssignments>
            <field>Legal_Document__c</field>
            <value>
                <elementReference>Create_Legal_Document_Object</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Legal_Opini_Approval_Id__c</field>
            <value>
                <elementReference>Create_Legal_Opini_Approval</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Legal_Opini__c</field>
            <value>
                <elementReference>Create_Legal_Opini_Object</elementReference>
            </value>
        </inputAssignments>
        <object>Application__c</object>
    </recordUpdates>
    <recordUpdates>
        <name>Update_Application_UUID</name>
        <label>Update Application UUID</label>
        <locationX>50</locationX>
        <locationY>816</locationY>
        <connector>
            <targetReference>Create_Legal_Opini_Object</targetReference>
        </connector>
        <inputAssignments>
            <field>Application_UUID__c</field>
            <value>
                <elementReference>Get_Loan.Application_UUID__c</elementReference>
            </value>
        </inputAssignments>
        <inputReference>$Record</inputReference>
    </recordUpdates>
    <recordUpdates>
        <name>Update_Loan</name>
        <label>Update Loan</label>
        <locationX>50</locationX>
        <locationY>600</locationY>
        <connector>
            <targetReference>Update_Survey_Set_Application_ID</targetReference>
        </connector>
        <inputReference>Get_Loan</inputReference>
    </recordUpdates>
    <recordUpdates>
        <name>Update_Loan_First_Installment</name>
        <label>Update Loan (First Installment)</label>
        <locationX>446</locationX>
        <locationY>1824</locationY>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>Copy_1_of_Get_Loan.Id</elementReference>
            </value>
        </filters>
        <inputAssignments>
            <field>First_Installment__c</field>
            <value>
                <elementReference>var_CalculatorResult.first_installment_type__c</elementReference>
            </value>
        </inputAssignments>
        <object>Opportunity</object>
    </recordUpdates>
    <recordUpdates>
        <name>Update_Survey_Set_Application_ID</name>
        <label>Update Survey (Set Application ID)</label>
        <locationX>50</locationX>
        <locationY>708</locationY>
        <connector>
            <targetReference>Update_Application_UUID</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>$Record.Survey__c</elementReference>
            </value>
        </filters>
        <inputAssignments>
            <field>Application_ID__c</field>
            <value>
                <elementReference>$Record.Application_ID__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Profesi_Berbahaya_Lookup__c</field>
            <value>
                <elementReference>Get_Loan.Risk_Occupation_Code__c</elementReference>
            </value>
        </inputAssignments>
        <object>Survey__c</object>
    </recordUpdates>
    <start>
        <locationX>122</locationX>
        <locationY>0</locationY>
        <connector>
            <targetReference>Get_Loan</targetReference>
        </connector>
        <object>Application__c</object>
        <recordTriggerType>Create</recordTriggerType>
        <scheduledPaths>
            <connector>
                <targetReference>Copy_1_of_Get_Loan</targetReference>
            </connector>
            <pathType>AsyncAfterCommit</pathType>
        </scheduledPaths>
        <triggerType>RecordAfterSave</triggerType>
    </start>
    <status>Active</status>
    <subflows>
        <name>Calculate</name>
        <label>Calculate</label>
        <locationX>446</locationX>
        <locationY>384</locationY>
        <connector>
            <targetReference>Calculation_Result</targetReference>
        </connector>
        <flowName>Calculator_Call_By_Application</flowName>
        <inputAssignments>
            <name>recordId</name>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>SaveResultToObject</name>
            <value>
                <booleanValue>false</booleanValue>
            </value>
        </inputAssignments>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </subflows>
    <subflows>
        <name>Get_Amortization</name>
        <label>Get Amortization</label>
        <locationX>314</locationX>
        <locationY>900</locationY>
        <connector>
            <targetReference>Upsert_Calculation_Result</targetReference>
        </connector>
        <flowName>API_Amortization_Calculation</flowName>
        <inputAssignments>
            <name>Capitalized_NTF_Amount_Input</name>
            <value>
                <elementReference>var_CalculatorResult.capitalized_ntf_amount__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>Effective_Rate_Input</name>
            <value>
                <elementReference>func_EffectiveRate</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>First_Installment_Input</name>
            <value>
                <stringValue>AR</stringValue>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>Grace_Periode_Installment_Input</name>
            <value>
                <stringValue>1</stringValue>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>Grace_Periode_Type_Input</name>
            <value>
                <stringValue>INTEREST_ONLY</stringValue>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>Installment_Scheme_Input</name>
            <value>
                <stringValue>RF</stringValue>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>Tenor_Input</name>
            <value>
                <elementReference>Copy_1_of_Get_Loan.Tenor__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>Tenor_Unit_Input</name>
            <value>
                <stringValue>MONTHLY</stringValue>
            </value>
        </inputAssignments>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </subflows>
    <variables>
        <name>var_CalculatorResult</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>API_Loan_Calculator_Non_KPR__c</objectType>
    </variables>
    <variables>
        <name>var_LODocument</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>Document_BFI__c</objectType>
    </variables>
    <variables>
        <name>var_OLDocument</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>Document_BFI__c</objectType>
    </variables>
    <variables>
        <name>var_OLDocuments</name>
        <dataType>SObject</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>Document_BFI__c</objectType>
    </variables>
</Flow>
